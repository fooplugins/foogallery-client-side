/*
* FooGallery - The Most Intuitive and Extensible Gallery Creation and Management Tool Ever Created for WordPress
* @version 0.0.1
* @link 
* @copyright Steven Usher & Brad Vincent 2015
* @license Released under the GPLv3 license.
*/
!function(a,b,c,d){b.Portfolio=c.Class.extend({construct:function(c,d){this.$el=a(c),this.options=a.extend(!0,{},b.Portfolio.defaults,d),this._items=[]},init:function(){var b=this;a(window).on("resize.portfolio",{self:b},b.onWindowResize),b.layout(!0)},destroy:function(){a(window).off("resize.portfolio")},parse:function(){var b=this;return b._items=b.$el.find(".fg-item").map(function(b,c){var d=a(c),e=d.find(".fg-thumb"),f=e.find(".fg-image");return d.find(".fg-caption").css("max-width",f.width()),{index:b,width:d.outerWidth(),height:d.outerHeight(),top:0,left:0,$item:d,$thumb:e}}).get()},round:function(a){return Math.round(2*a)/2},layout:function(a,b){a=!!d.boolean(a)&&a,b=!d.boolean(b)||b,(a||0===this._items.length)&&this.parse();for(var c,e=this,f=e.$el.width(),g=e.rows(f),h=0,i=0,j=g.length;i<j;i++)c=g[i],h=e.position(c,f,h,"center"),e.render(c);e.$el.height(h),b&&e.$el.width()<f&&e.layout(!1,!1)},render:function(a){for(var b,c=0,d=a.items.length;c<d;c++)b=a.items[c],a.visible?b.$item.css({width:b.width,height:a.height,top:b.top,left:b.left,display:""}).addClass("fg-positioned"):b.$item.css("display","none")},position:function(a,b,c,d){var e=this,f=a.items[a.items.length-1],g=b-(f.left+f.width);a.index>0&&(c+=e.options.gutter),a.top=c;for(var h,i=0,j=a.items.length;i<j;i++)h=a.items[i],h.top=c,"center"===d?h.left+=g/2:"right"===d&&(h.left+=g);return c+a.height},items:function(){return a.map(this._items,function(a){return{index:a.index,width:a.width,height:a.height,$item:a.$item,$thumb:a.$thumb,top:a.top,left:a.left}})},rows:function(a){for(var b=this,c=b.items(),d=[],e=c.length>0,f=-1,g=0;e;){f+=1,f>0&&(g+=b.options.gutter);for(var h,i,j,k={index:f,visible:!0,top:g,width:0,height:0,items:[]},l=[],m=0,n=0,o=c.length;n<o&&(i=c[n],!((h=k.width+i.width)>a&&n>0));n++)h>a&&0==n&&(h=a,j=a/i.width,i.width=b.round(i.width*j),i.height=b.round(i.height*j),k.height=i.height),i.top=k.top,n>0&&(m+=b.options.gutter),n!==o-1&&(h+=b.options.gutter),i.left=m,m+=i.width,i.height>k.height&&(k.height=i.height),k.width=h,k.items.push(i),l.push(n);if(0===l.length){e=!1;break}l.sort(function(a,b){return b-a});for(var p=0,q=l.length;p<q;p++)c.splice(l[p],1);d.push(k),e=c.length>0}return d},onWindowResize:function(a){a.data.self.layout()}}),b.Portfolio.defaults={gutter:40}}(FooGallery.$,FooGallery,FooGallery.utils,FooGallery.utils.is),function(a,b){b.PortfolioTemplate=b.Template.extend({construct:function(a){this._super(a),this.portfolio=new b.Portfolio(this.fg.$el.get(0),this.options),this.isCaptionTop=!1},onpreinit:function(){this.isCaptionTop=this.fg.$el.hasClass("fg-captions-top"),this.portfolio.init(),this._super()},onitemsparsed:function(a){this.portfolio.layout(),this._super(a)},onitemcreate:function(a){this.raise("item-create",[a]),a.createDOM(!0),a.isCaptionCreated&&(this.isCaptionTop?a.$caption.insertBefore(a.$anchor):a.$caption.insertAfter(a.$anchor))},onitemsloaded:function(a){this.portfolio.layout(),this._super(a)},onitemsappended:function(a){this.portfolio.layout(!0),this._super(a)},onitemsdetached:function(a){this.portfolio.layout(!0),this._super(a)}}),b.template.register("portfolio",b.PortfolioTemplate,function(a){return a.is(".fg-portfolio")})}(FooGallery.$,FooGallery);