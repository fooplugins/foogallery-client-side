/*
* FooGallery - The Most Intuitive and Extensible Gallery Creation and Management Tool Ever Created for WordPress
* @version 1.2.7
* @link 
* @copyright Steven Usher & Brad Vincent 2015
* @license Released under the GPLv3 license.
*/

!function(a,b,c,d,e){b.Panel=b.Component.extend({construct:function(a,b){var c=this;c._super(a),c.opt=b,c.$el=null,c.$prev=null,c.$next=null,c.$close=null,c.$external=null,c.$fullscreen=null,c.$fullscreenWrap=null,c.isFullscreen=!1,c.isBusy=!1,c.isFirst=!0,c.showCaptions=!1,c.hasTransition=!1,c.currentItem=null},preinit:function(){var b=this;b.$el=a("<section/>",{class:"foogrid-content"}),b.$prev=a("<span/>",{class:"foogrid-nav-prev"}).append("<i/>"),b.$next=a("<span/>",{class:"foogrid-nav-next"}).append("<i/>"),b.$close=a("<span/>",{class:"foogrid-nav-close"}),b.$fullscreen=a("<span/>",{class:"foogrid-nav-fullscreen"}),b.$external=a("<a/>",{class:"foogrid-nav-external"}),b.$fullscreenWrap=a("<div/>"),b.showCaptions=b.tmpl.$el.hasClass("foogrid-caption-below")||b.tmpl.$el.hasClass("foogrid-caption-right"),b.hasTransition=b.tmpl.$el.hasClass("foogrid-transition-fade")||b.tmpl.$el.hasClass("foogrid-transition-horizontal")||b.tmpl.$el.hasClass("foogrid-transition-vertical"),b.disableTransitions=!1,b.$el.append(b.$prev,b.$next,b.$close,b.$fullscreen,b.$external)},init:function(){var a=this;a.$prev.on("click.gg",{self:a},a.onPrevClick),a.$next.on("click.gg",{self:a},a.onNextClick),a.$close.on("click.gg",{self:a},a.onCloseClick),a.$fullscreen.on("click.gg",{self:a},a.onFullscreenClick),a.opt.keyboard&&a.$el.attr("tabindex",1).on("keydown",{self:a},a.onKeyDown),c.empty(a.opt.externalText)||a.$external.attr("target",a.opt.external).addClass("foogrid-external-text").html(a.opt.externalText)},destroy:function(){var a=this;a.$prev.off("click.gg",a.onPrevClick),a.$next.off("click.gg",a.onNextClick),a.$close.off("click.gg",a.onCloseClick),a.$fullscreen.off("click.gg",a.onFullscreenClick),a.$fullscreenWrap.remove(),a.$el.remove(),a._super()},layout:function(a,b){this.checkForLoop()},onParsedOrCreatedItem:function(b){if(!b.isError){var d=this;b.$anchor.on("click.gg",{self:d,item:b},d.onAnchorClick),b.$content=a("<div/>",{class:"foogrid-content-inner"}),b.content.appendTo(b.$content),b.$content.addClass("foogrid-content-"+b.type);var e=!c.empty(b.caption),f=!c.empty(b.description);if(e||f){var g=a("<div/>",{class:"foogrid-caption"}).append(a("<div/>",{class:"foogrid-caption-separator"}));e&&g.append(a("<h4/>",{class:"foogrid-title"}).html(b.caption)),f&&g.append(a("<p/>",{class:"foogrid-description"}).html(b.description)),b.$content.addClass("foogrid-has-caption").append(g),b.hasCaption=!0}}},transitionsEnabled:function(){return e.supported&&!this.disableTransitions&&this.hasTransition},getValidIndex:function(a,b){var d=this,e=a.length;return c.number(b)?0===e?b=-1:b<0?b=d.opt.loop?e-1:0:b>=e&&(b=d.opt.loop?0:e-1):b=-1,b},getItemBottom:function(a){var b=a.bounds();return null==b?0:b.bottom},checkForLoop:function(){var a=this,c=a.tmpl.getAvailable(),d=a.currentItem instanceof b.Item,e=c.length-1;a.$prev.toggleClass("foogrid-disabled",a.isFirst||!a.opt.loop&&d&&0==a.currentItem.index),a.$next.toggleClass("foogrid-disabled",a.isFirst||!a.opt.loop&&d&&a.currentItem.index==e)},scrollTo:function(b,d,e){var f=this;b=(c.number(b)?b:0)-+f.opt.scrollOffset,d=!c.boolean(d)||d,e=c.number(e)?e:300;var g=a("#wpadminbar"),h=a("html, body");return 1===g.length&&(b-=g.height()),a.Deferred(function(a){f.opt.scroll&&d?f.opt.scrollSmooth&&!f.isFullscreen?h.animate({scrollTop:b},e,function(){a.resolve()}):(h.scrollTop(b),a.resolve()):a.resolve()})},open:function(c){var d=this;if(d.isBusy)return a.when();d.isBusy=!0;var e=d.tmpl.getAvailable(),f=d.getValidIndex(e,c);if(-1!=f){var g=d.currentItem,h=e[f],i=e.length-1,j=!0,k=!1;if(g instanceof b.Item){var l=d.getItemBottom(g),m=d.getItemBottom(h);if(k=l!=m,j=g.index<f,(0===f&&g.index===i||f===i&&0===g.index)&&(j=!j),d.$el.removeClass("foogrid-has-caption"),k&&!d.isFullscreen)return d.isBusy=!1,d._close(j,k).then(function(){return d.isBusy=!0,d._open(h,k,j)});d.closeItem(g,j)}return d._open(h,k,j)}return a.when()},_open:function(c,d,f){var g=this;return a.Deferred(function(a){if(!(c instanceof b.Item))return void a.reject();g.scrollTo(c.$el.offset().top,d||g.isFirst).then(function(){!d&&!g.isFirst||g.isFullscreen||(c.$el.after(g.$el),g.$external.attr("href",c.content.external)),g.transitionsEnabled()&&!g.isFullscreen&&(g.opt.transitionOpen&&g.isFirst||g.opt.transitionRow&&d)?(g.isFirst=!1,e.start(g.$el,"foogrid-visible",!0,350).then(function(){a.resolve()})):(g.$el.addClass("foogrid-visible"),a.resolve())})}).then(function(){return g.currentItem=c,g.checkForLoop(),g.openItem(c,f).then(function(){return g.$el.focus(),g.isBusy=!1,g.scrollTo(c.$el.offset().top,!0)})})},openItem:function(b,c){var d=this;return a.Deferred(function(a){b.$el.removeClass("foogrid-visible"),b.$content.toggleClass("foogrid-reverse",c),d.$el.append(b.$content),b.content.appendTo(b.$content),b.content.load(),d.transitionsEnabled()?e.start(b.$content,"foogrid-visible",!0,1e3).then(function(){a.resolve()}):(b.$content.addClass("foogrid-visible"),a.resolve())}).promise().always(function(){b.$content.removeClass("foogrid-reverse")})},close:function(a){a=!!c.boolean(a)&&a;var b=this;return b.disableTransitions=a,b._close().then(function(){b.disableTransitions=!1})},_close:function(c,d){var f=this;return f.isBusy?a.when():(f.isBusy=!0,a.Deferred(function(a){f.currentItem instanceof b.Item?f.closeItem(f.currentItem,c).then(function(){f.transitionsEnabled()&&!f.isFullscreen&&(f.opt.transitionRow&&d||f.opt.transitionOpen&&!d)?e.start(f.$el,"foogrid-visible",!1,350).then(function(){a.resolve()}):(f.$el.removeClass("foogrid-visible"),a.resolve())}):a.resolve()}).promise().always(function(){f.$el.removeClass("foogrid-has-caption foogrid-fullscreen").detach(),f.$prev.add(f.$next).removeClass("foogrid-disabled"),f.isFullscreen=!1,f.currentItem=null,f.isBusy=!1,d||(f.isFirst=!0)}))},closeItem:function(b,c){var d=this;return a.Deferred(function(a){b.$el.removeClass("foogrid-visible"),b.$content.toggleClass("foogrid-reverse",!c),d.transitionsEnabled()?e.start(b.$content,"foogrid-visible",!1,350).then(function(){b.$content.removeClass("foogrid-reverse").detach(),a.resolve()}):(b.$content.removeClass("foogrid-visible foogrid-reverse").detach(),a.resolve())}).promise().always(function(){b.content.detach()})},prev:function(){var a=this;return a.currentItem instanceof b.Item?a.open(a.currentItem.index-1):d.reject()},next:function(){var a=this;return a.currentItem instanceof b.Item?a.open(a.currentItem.index+1):d.reject()},toggle:function(a){var c=this;return a instanceof b.Item?c.currentItem==a?c._close():c.open(a.index):d.reject()},toggleFullscreen:function(){var a=this;a.$el.hasClass("foogrid-fullscreen")&&a.currentItem instanceof b.Item?(a.currentItem.$el.after(a.$el.removeClass("foogrid-fullscreen")),a.$fullscreenWrap.remove(),a.$el.focus(),a.isFullscreen=!1):(a.$fullscreenWrap.attr("class",a.tmpl.$el.attr("class")).append(a.$el.addClass("foogrid-fullscreen")).appendTo("body"),a.$el.focus(),a.isFullscreen=!0)},onPrevClick:function(a){a.preventDefault();var b=a.data.self;b.$prev.hasClass("foogrid-disabled")||b.prev()},onNextClick:function(a){a.preventDefault();var b=a.data.self;b.$next.hasClass("foogrid-disabled")||b.next()},onCloseClick:function(a){a.preventDefault(),a.data.self._close()},onFullscreenClick:function(a){a.preventDefault(),a.data.self.toggleFullscreen()},onKeyDown:function(a){var b=a.data.self;switch(a.which){case 39:b.next();break;case 37:b.prev();break;case 27:b.isFullscreen?b.toggleFullscreen():b._close();break;case 13:a.altKey&&b.toggleFullscreen()}},onAnchorClick:function(a){a.preventDefault(),a.data.self.toggle(a.data.item)}})}(FooGallery.$,FooGallery,FooGallery.utils.is,FooGallery.utils.fn,FooGallery.utils.transition),function(a,b,c){b.FooGridTemplate=b.Template.extend({construct:function(a,c){var d=this;d._super(a,c),d.foogrid=new b.Panel(d,d.template),d.hadState=!1},onPreInit:function(a,b){b.foogrid.preinit()},onInit:function(a,b){b.foogrid.init()},onDestroy:function(a,b){b.foogrid.destroy()},onParsedItem:function(a,b,c){b.foogrid.onParsedOrCreatedItem(c)},onCreatedItem:function(a,b,c){b.foogrid.onParsedOrCreatedItem(c)},onAfterState:function(a,b,c){c.item&&(b.foogrid.layout(!0,c.item.index),b.foogrid.open(c.item.index),b.hadState=!0)},onFirstLoad:function(a,b){b.foogrid.layout(!b.hadState)},onReady:function(a,b){b.foogrid.layout()},onBeforePageChange:function(a,b,c,d,e,f){f||b.foogrid.close(!0)},onAfterPageChange:function(a,b,c,d,e){e||b.foogrid.layout(!0)},onBeforeFilterChange:function(a,b,c,d,e){b.foogrid.close(!0)},onAfterFilterChange:function(a,b){b.foogrid.layout(!0)}}),b.template.register("foogrid",b.FooGridTemplate,{template:{scroll:!0,scrollOffset:0,scrollSmooth:!0,loop:!0,external:"_blank",externalText:null,keyboard:!0,transitionRow:!0,transitionOpen:!0}},{container:"foogallery foogrid"})}(FooGallery.$,FooGallery,FooGallery.utils);