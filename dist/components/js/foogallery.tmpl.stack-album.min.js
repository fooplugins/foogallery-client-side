/*
* FooGallery - The Most Intuitive and Extensible Gallery Creation and Management Tool Ever Created for WordPress
* @version 2.0.45
* @link 
* @copyright Steven Usher & Brad Vincent 2015
* @license Released under the GPLv3 license.
*/
!function(o,a,t,r,l,n){a.StackAlbum=t.Class.extend({construct:function(t,e){var i=this;i.$el=r.jq(t)?t:o(t),i.el=i.$el.get(0),i.opt=l.extend({},a.StackAlbum.defaults,e,i.$el.data("foogallery")),i.$back=i.$el.find(".fg-header-back"),i.$active=i.$el.find(".fg-header-active"),i.$piles=i.$el.find(".fg-piles"),i.piles=i.$piles.find(".fg-pile").map(function(t,e){return new a.StackAlbum.Pile(i,e,{index:t})}).get(),i.ignoreResize=!1,i.robserver=new ResizeObserver(function(){!i.ignoreResize&&i.$el.is(":visible")&&i.layout(!0)})},init:function(){var t=this;t.piles.forEach(function(t){t.init()}),t.$back.on("click.foogallery",{self:t},t.onBackClick),t.robserver.observe(t.el)},destroy:function(){var t=this;t.robserver.disconnect(),t.$back.off(".foogallery"),t.piles.forEach(function(t){t.destroy()})},getLayoutInfo:function(){var t=this,e=t.opt.gutter+2*t.opt.border;return{maxWidth:t.$el.width(),space:e,halfSpace:e/2,itemWidth:t.opt.itemWidth,itemHeight:t.opt.itemHeight,itemOuterWidth:t.opt.itemWidth+2*t.opt.border,itemOuterHeight:t.opt.itemHeight+2*t.opt.border,blockWidth:t.opt.itemWidth+e,blockHeight:t.opt.itemHeight+e,border:t.opt.border,doubleBorder:2*t.opt.border,gutter:t.opt.gutter,halfGutter:t.opt.gutter/2}},layout:function(t){var e,i=this;t&&(i.$el.addClass("fg-disable-transitions"),i.$el.prop("offsetWidth")),i.hasActive?(e=i.activePile.layout(),i.activePile.setPosition(0,0,e.width,e.height)):e=i.layoutPiles(),i.$piles.css({width:e.width+"px",height:e.height+"px"}),t&&i.$el.removeClass("fg-disable-transitions")},layoutPiles:function(o){var l=this.getLayoutInfo(),a=0,n=1,s=0;return o=r.fn(o)?o:function(){},this.piles.forEach(function(t){var e=a,i=((a+=l.blockWidth)>l.maxWidth&&(e=0,a=l.blockWidth,n++),l.blockHeight*(n-1));o(t,i,e,l.blockWidth,l.blockHeight),t.setPosition(i,e,l.blockWidth,l.blockHeight),s<a&&(s=a)}),{width:s,height:l.blockHeight*n}},setActive:function(e){var i,o=this,t=o.activePile,l=t instanceof a.StackAlbum.Pile;e=e instanceof a.StackAlbum.Pile?e:null,o.activePile=e,o.hasActive=null!==e,l&&t.collapse(),o.ignoreResize=!0,o.hasActive?(o.piles.forEach(function(t){t!==e&&t.hide(o.activePile)}),i=o.activePile.expand(),o.$active.text(e.title),o.$el.addClass("fg-has-active")):(i=o.layoutPiles(function(t){t.show()}),o.$el.removeClass("fg-has-active")),n.start(o.$piles,function(t){t.css({width:i.width+"px",height:i.height+"px"})},null,350).then(function(){o.ignoreResize=!1})},onBackClick:function(t){t.preventDefault(),t.stopPropagation(),t.data.self.setActive(null)}}),a.StackAlbum.defaults={gutter:50,itemWidth:150,itemHeight:150,border:10,angleStep:1,randomAngle:!1}}(FooGallery.$,FooGallery,FooGallery.utils,FooGallery.utils.is,FooGallery.utils.obj,FooGallery.utils.transition),function(l,a,t,n,s){a.StackAlbum.Pile=t.Class.extend({construct:function(t,e,i){var o=this;o.album=t,o.$el=n.jq(e)?e:l(e),o.opt=s.extend({},a.StackAlbum.Pile.defaults,i,o.$el.data()),o.title=o.opt.title,o.items=o.$el.find(".fg-pile-item").map(function(t,e){return new a.StackAlbum.Item(o,e,{index:t})}).get(),o.$cover=l("<div/>",{class:"fg-pile-cover"}).append(l("<div/>",{class:"fg-pile-cover-content"}).append(l("<span/>",{class:"fg-pile-cover-title",text:o.opt.title}),l("<span/>",{class:"fg-pile-cover-count",text:o.items.length}))),o.top=0,o.left=0,o.isExpanded=!1},init:function(){var i=this,o=i.album.opt,l=i.getAngles(o.angleStep),a=o.randomAngle?i.randomAngle(l):o.angleStep;i.$cover.on("click.foogallery",{self:i},i.onCoverClick),i.items.forEach(function(t,e){t.init(),3<e||(0===e?(t.$el.addClass("fg-has-cover").append(i.$cover),t.load()):(e%2==0?t.setAngle(-a):t.setAngle(a),o.randomAngle?a=i.randomAngle(l):a+=o.angleStep))})},destroy:function(){this.$cover.remove(),this.items.forEach(function(t,e){0===e&&t.$el.removeClass("fg-has-cover"),t.destroy()})},getAngles:function(t){for(var e=[],i=1;i<=3;i++)e.push(i*t);return e},randomAngle:function(t){var e=t.length,e=Math.floor(Math.random()*+e+0),t=t.splice(e,1);return 1===t.length?t[0]:0},setPosition:function(t,e,i,o){this.top=t,this.left=e,n.number(i)&&n.number(o)?this.$el.css({top:t+"px",left:e+"px",width:i+"px",height:o+"px"}):this.$el.css({top:t+"px",left:e+"px"})},layout:function(){var o=this.album.getLayoutInfo(),l=0,a=1,n=!1,s=0;return this.items.forEach(function(t){(l+=o.halfGutter)>o.maxWidth&&(l=o.halfGutter,a++,n=!0);var e=l,i=(l+=o.itemOuterWidth+o.halfGutter,!n&&l>o.maxWidth&&(e=o.halfGutter,l=o.blockWidth,a++),o.blockHeight*(a-1)+o.halfGutter);n=!1,t.setPosition(i,e,o.itemOuterWidth,o.itemOuterHeight),t.isLoaded||t.load(),s<l&&(s=l)}),{width:s,height:o.blockHeight*a}},expand:function(){var t;return this.$el.removeClass("fg-collapsed").addClass("fg-expanded"),t=this.layout(),this.setPosition(0,0,t.width,t.height),this.isExpanded=!0,t},collapse:function(){var t=this,e=t.album.getLayoutInfo(),i=(t.$el.removeClass("fg-expanded").addClass("fg-collapsed"),t.items.forEach(function(t){t.setPosition(e.halfGutter,e.halfGutter,e.itemOuterWidth,e.itemOuterHeight)}),{width:e.blockWidth,height:e.blockHeight});return t.setPosition(0,0,i.width,i.height),t.isExpanded=!1,i},show:function(){this.$el.removeClass("fg-hidden fg-expanded fg-collapsed")},hide:function(t){t instanceof a.StackAlbum.Pile&&this.setPosition(t.top,t.left),this.$el.addClass("fg-hidden")},onCoverClick:function(t){t.preventDefault(),t.stopPropagation();t=t.data.self;t.album.setActive(t)}}),a.StackAlbum.Pile.defaults={index:-1,title:null}}(FooGallery.$,FooGallery,FooGallery.utils,FooGallery.utils.is,FooGallery.utils.obj),function(l,a,t,n,s){a.StackAlbum.Item=t.Class.extend({construct:function(t,e,i){var o=this;o.$el=n.jq(e)?e:l(e),o.opt=s.extend({},a.StackAlbum.Item.defaults,i,o.$el.data()),o.$thumb=o.$el.find(".fg-pile-item-thumb"),o.$image=o.$el.find(".fg-pile-item-image"),o.isLoaded=!1,o.isLoading=!1,o._loading=null},init:function(){},destroy:function(){},setAngle:function(t){this.$el.css({transform:"rotate("+t+"deg)"})},setPosition:function(t,e,i,o){this.$el.css({top:t+"px",left:e+"px",width:i+"px",height:o+"px"})},load:function(){var e=this;return n.promise(e._loading)?e._loading:e._loading=l.Deferred(function(t){e.$el.addClass("fg-loading"),e.isLoading=!0,e.$image.on({"load.foogallery":function(){e.$image.off(".foogallery"),e.$el.removeClass("fg-loading"),e.isLoading=!1,e.isLoaded=!0,t.resolve()},"error.foogallery":function(){e.$image.off(".foogallery"),e.$el.removeClass("fg-loading"),e.isLoading=!1,e.isLoaded=!0,t.reject()}}),e.$image.prop("src",e.$image.attr(e.opt.src)).prop("srcset",e.$image.attr(e.opt.srcset))}).promise()}}),a.StackAlbum.Item.defaults={index:-1,src:"data-src-fg",srcset:"data-srcset-fg"}}(FooGallery.$,FooGallery,FooGallery.utils,FooGallery.utils.is,FooGallery.utils.obj),function(o,l,t){o.fn.foogalleryStackAlbum=function(t){return this.each(function(t,e){var e=o(e),i=e.data("__FooGalleryAlbum__");i instanceof l.StackAlbum&&i.destroy(),(i=new l.StackAlbum(e)).init(),e.data("__FooGalleryAlbum__",i)})},l.loadStackAlbums=l.reloadStackAlbums=function(){o(function(){o(".foogallery-stack-album:not(.fg-ready)").foogalleryStackAlbum()}),t.ready(function(){o(".foogallery-stack-album.fg-ready").foogalleryStackAlbum()})},l.loadStackAlbums()}(FooGallery.$,FooGallery,FooGallery.utils);