/*
* FooGallery - The Most Intuitive and Extensible Gallery Creation and Management Tool Ever Created for WordPress
* @version 2.1.2
* @link 
* @copyright Steven Usher & Brad Vincent 2015
* @license Released under the GPLv3 license.
*/
!function(o,a,t,r,l,n){a.StackAlbum=t.Class.extend({construct:function(t,e){var i=this;i.$el=r.jq(t)?t:o(t),i.el=i.$el.get(0),i.opt=l.extend({},a.StackAlbum.defaults,e,i.$el.data("foogallery")),i.$back=i.$el.find(".fg-header-back"),i.$active=i.$el.find(".fg-header-active"),i.$piles=i.$el.find(".fg-piles"),i.piles=i.$piles.find(".fg-pile").map(function(t,e){return new a.StackAlbum.Pile(i,e,{index:t})}).get(),i.ignoreResize=!1,i.info=i.getLayoutInfo(),i.robserver=new ResizeObserver(function(t){var e;!i.ignoreResize&&i.$el.is(":visible")&&(e=i.$el.width(),i.info.maxWidth!==e&&(i.info=i.getLayoutInfo(),i.layout(!0)))})},init:function(){var t=this;t.info=t.getLayoutInfo(),t.piles.forEach(function(t){t.init()}),t.$back.on("click.foogallery",{self:t},t.onBackClick),t.layout(!0),t.robserver.observe(t.el)},destroy:function(){var t=this;t.robserver.disconnect(),t.$back.off(".foogallery"),t.piles.forEach(function(t){t.destroy()})},getLayoutInfo:function(){var t=this,e=t.$el.width(),i=2*t.opt.border,o=t.opt.gutter+i,l=e-o;let a=1;t.opt.itemWidth>l&&(a=l/t.opt.itemWidth);var l=t.opt.itemWidth*a,n=t.opt.itemHeight*a;return{maxWidth:e,space:o,halfSpace:o/2,itemWidth:l,itemHeight:n,itemOuterWidth:l+i,itemOuterHeight:n+i,blockWidth:l+o,blockHeight:n+o,border:t.opt.border,doubleBorder:i,gutter:t.opt.gutter,halfGutter:t.opt.gutter/2}},layout:function(t){var e,i=this;t&&(i.$el.addClass("fg-disable-transitions"),i.$el.prop("offsetWidth")),i.hasActive?(e=i.activePile.layout(),i.activePile.setPosition(0,0,e.width,e.height)):e=i.layoutPiles(),i.$piles.css({width:e.width+"px",height:e.height+"px"}),t&&setTimeout(function(){i.$el.removeClass("fg-disable-transitions")},0)},layoutPiles:function(o){var l=this,a=0,n=1,s=0;return o=r.fn(o)?o:function(){},l.piles.forEach(function(t){var e=a,i=((a+=l.info.blockWidth)>l.info.maxWidth&&0<e&&(e=0,a=l.info.blockWidth,n++),l.info.blockHeight*(n-1));o(t,l.info),t.layoutCollapsed(),t.setPosition(i,e,l.info.blockWidth,l.info.blockHeight),s<a&&(s=a)}),{width:s,height:l.info.blockHeight*n}},setActive:function(e){var i,o=this,t=o.activePile,l=t instanceof a.StackAlbum.Pile;e=e instanceof a.StackAlbum.Pile?e:null,o.activePile=e,o.hasActive=null!==e,l&&t.collapse(),o.ignoreResize=!0,o.hasActive?(o.piles.forEach(function(t){t!==e&&t.hide(o.activePile)}),i=o.activePile.expand(),o.$active.text(e.title),o.$el.addClass("fg-has-active")):(i=o.layoutPiles(function(t){t.show()}),o.$el.removeClass("fg-has-active")),n.start(o.$piles,function(t){t.css({width:i.width+"px",height:i.height+"px"})},null,350).then(function(){o.ignoreResize=!1})},onBackClick:function(t){t.preventDefault(),t.stopPropagation(),t.data.self.setActive(null)}}),a.StackAlbum.defaults={gutter:50,itemWidth:150,itemHeight:150,border:10,angleStep:1,randomAngle:!1}}(FooGallery.$,FooGallery,FooGallery.utils,FooGallery.utils.is,FooGallery.utils.obj,FooGallery.utils.transition),function(n,l,t,a,s){l.StackAlbum.Pile=t.Class.extend({construct:function(t,e,i){var o=this;o.album=t,o.$el=a.jq(e)?e:n(e),o.opt=s.extend({},l.StackAlbum.Pile.defaults,i,o.$el.data()),o.title=o.opt.title,o.items=o.$el.find(".fg-pile-item").map(function(t,e){return new l.StackAlbum.Item(o,e,{index:t})}).get(),o.$cover=o.$el.find(".fg-pile-cover").first(),o.top=0,o.left=0,o.isExpanded=!1},init:function(){var i=this,o=i.album.opt,l=i.getAngles(o.angleStep),a=o.randomAngle?i.randomAngle(l):o.angleStep;0===i.$cover.length&&0<i.items.length&&(i.$cover=n("<div/>",{class:"fg-pile-cover"}).append(n("<div/>",{class:"fg-pile-cover-content"}).append(n("<span/>",{class:"fg-pile-cover-title",text:i.opt.title}),n("<span/>",{class:"fg-pile-cover-count",text:i.items.length}))),i.items[0].$el.addClass("fg-has-cover").append(i.$cover)),i.$cover.on("click.foogallery",{self:i},i.onCoverClick),i.items.forEach(function(t,e){t.init(),3<e||(0===e?t.load():(e%2==0?t.setAngle(-a):t.setAngle(a),o.randomAngle?a=i.randomAngle(l):a+=o.angleStep))})},destroy:function(){this.$cover.remove(),this.items.forEach(function(t,e){0===e&&t.$el.removeClass("fg-has-cover"),t.destroy()})},getAngles:function(t){for(var e=[],i=1;i<=3;i++)e.push(i*t);return e},randomAngle:function(t){var e=t.length,e=Math.floor(Math.random()*+e+0),t=t.splice(e,1);return 1===t.length?t[0]:0},setPosition:function(t,e,i,o){this.top=t,this.left=e,a.number(i)&&a.number(o)?this.$el.css({top:t+"px",left:e+"px",width:i+"px",height:o+"px"}):this.$el.css({top:t+"px",left:e+"px"})},layout:function(){const o=this.album.info;if(!this.isExpanded)return this.layoutCollapsed();let l=0,a=1,n=!1,s=0;return this.items.forEach(function(t){(l+=o.halfGutter)>o.maxWidth&&(l=o.halfGutter,a++,n=!0,console.log("A"));var e=l,i=(l+=o.itemOuterWidth+o.halfGutter,!n&&l>o.maxWidth&&(e=o.halfGutter,l=o.blockWidth,a++,console.log("B")),o.blockHeight*(a-1)+o.halfGutter);n=!1,t.setPosition(i,e,o.itemOuterWidth,o.itemOuterHeight),t.isLoaded||t.load(),l>s&&(s=l)}),{width:s,height:o.blockHeight*a}},layoutCollapsed:function(){const e=this.album.info;return this.items.forEach(function(t){t.setPosition(e.halfGutter,e.halfGutter,e.itemOuterWidth,e.itemOuterHeight)}),{width:e.blockWidth,height:e.blockHeight}},expand:function(){var t;return this.$el.removeClass("fg-collapsed").addClass("fg-expanded"),this.isExpanded=!0,t=this.layout(),this.setPosition(0,0,t.width,t.height),t},collapse:function(){var t;return this.$el.removeClass("fg-expanded").addClass("fg-collapsed"),this.isExpanded=!1,t=this.layout(),this.setPosition(0,0,t.width,t.height),t},show:function(){this.$el.removeClass("fg-hidden fg-expanded fg-collapsed")},hide:function(t){t instanceof l.StackAlbum.Pile&&this.setPosition(t.top,t.left),this.$el.addClass("fg-hidden")},onCoverClick:function(t){t.preventDefault(),t.stopPropagation();t=t.data.self;t.album.setActive(t)}}),l.StackAlbum.Pile.defaults={index:-1,title:null}}(FooGallery.$,FooGallery,FooGallery.utils,FooGallery.utils.is,FooGallery.utils.obj),function(l,a,t,n,s){a.StackAlbum.Item=t.Class.extend({construct:function(t,e,i){var o=this;o.pile=t,o.$el=n.jq(e)?e:l(e),o.opt=s.extend({},a.StackAlbum.Item.defaults,i,o.$el.data()),o.$thumb=o.$el.find(".fg-pile-item-thumb"),o.$image=o.$el.find(".fg-pile-item-image"),o.isLoaded=!1,o.isLoading=!1,o._loading=null},init:function(){var t=this.pile.album.info;this.$el.css({width:t.itemOuterWidth+"px",height:t.itemOuterHeight+"px"})},destroy:function(){this.$el.css({top:"",left:"",width:"",height:"",transform:""})},setAngle:function(t){this.$el.css({transform:"rotate("+t+"deg)"})},setPosition:function(t,e,i,o){this.$el.css({top:t+"px",left:e+"px",width:i+"px",height:o+"px"})},load:function(){var e=this;return n.promise(e._loading)?e._loading:e._loading=l.Deferred(function(t){e.$el.addClass("fg-loading"),e.isLoading=!0,e.$image.on({"load.foogallery":function(){e.$image.off(".foogallery"),e.$el.removeClass("fg-loading"),e.isLoading=!1,e.isLoaded=!0,t.resolve()},"error.foogallery":function(){e.$image.off(".foogallery"),e.$el.removeClass("fg-loading"),e.isLoading=!1,e.isLoaded=!0,t.reject()}}),e.$image.prop("src",e.$image.attr(e.opt.src)).prop("srcset",e.$image.attr(e.opt.srcset))}).promise()}}),a.StackAlbum.Item.defaults={index:-1,src:"data-src-fg",srcset:"data-srcset-fg"}}(FooGallery.$,FooGallery,FooGallery.utils,FooGallery.utils.is,FooGallery.utils.obj),function(o,l,t){o.fn.foogalleryStackAlbum=function(t){return this.each(function(t,e){var e=o(e),i=e.data("__FooGalleryAlbum__");i instanceof l.StackAlbum&&i.destroy(),(i=new l.StackAlbum(e)).init(),e.data("__FooGalleryAlbum__",i)})},l.loadStackAlbums=l.reloadStackAlbums=function(){o(function(){o(".foogallery-stack-album:not(.fg-ready)").foogalleryStackAlbum()}),t.ready(function(){o(".foogallery-stack-album.fg-ready").foogalleryStackAlbum()})},l.loadStackAlbums()}(FooGallery.$,FooGallery,FooGallery.utils);