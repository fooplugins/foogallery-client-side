/*
* FooGallery - The Most Intuitive and Extensible Gallery Creation and Management Tool Ever Created for WordPress
* @version 2.0.10
* @link 
* @copyright Steven Usher & Brad Vincent 2015
* @license Released under the GPLv3 license.
*/

!function(a,b,c,d){a.FilteringFactory=a.Factory.extend({construct:function(){this.registered={}},register:function(a,c,d,e,f,g,h){var i=this,j=i._super(a,c,h);if(j){var k=i.registered;k[a].ctrl=b.fn(d)?d:null,k[a].opt=b.hash(e)?e:{},k[a].cls=b.hash(f)?f:{},k[a].il8n=b.hash(g)?g:{}}return j},type:function(a){var c,d=this;return b.hash(a)&&b.hash(c=a.filtering)&&b.string(c.type)&&d.contains(c.type)?c.type:null},merge:function(a){a=d.extend({},a);var c=this,e=c.type(a),f=c.registered,g=f.default.opt,h=f.default.cls,i=f.default.il8n,j=b.hash(a.filtering)?a.filtering:{},k=b.hash(a.cls)&&b.hash(a.cls.filtering)?d.extend({},a.cls.filtering):{},l=b.hash(a.il8n)&&b.hash(a.il8n.filtering)?d.extend({},a.il8n.filtering):{};return b.hash(a.cls)||(a.cls={}),b.hash(a.il8n)||(a.il8n={}),"default"!==e&&c.contains(e)?(a.filtering=d.extend({},g,f[e].opt,j,{type:e}),a.cls=d.extend(a.cls,{filtering:h},{filtering:f[e].cls},{filtering:k}),a.il8n=d.extend(a.il8n,{filtering:i},{filtering:f[e].il8n},{filtering:l})):(a.filtering=d.extend({},g,j,{type:e}),a.cls=d.extend(a.cls,{filtering:h},{filtering:k}),a.il8n=d.extend(a.il8n,{filtering:i},{filtering:l})),a},configure:function(a,b,c,e){var f=this;if(f.contains(a)){var g=f.registered;d.extend(g[a].opt,b),d.extend(g[a].cls,c),d.extend(g[a].il8n,e)}},hasCtrl:function(a){var c=this,d=c.registered[a];return b.hash(d)&&b.fn(d.ctrl)},makeCtrl:function(a,c,d,e){var f=this,g=f.registered[a];return b.hash(g)&&b.fn(g.ctrl)?new g.ctrl(c,d,e):null}}),a.filtering=new a.FilteringFactory}(FooGallery,FooGallery.utils.is,FooGallery.utils.fn,FooGallery.utils.obj),function(a,b,c,d){b.Filtering=b.Component.extend({construct:function(a){var b=this;b._super(a),b.opt=b.tmpl.opt.filtering,b.cls=b.tmpl.cls.filtering,b.il8n=b.tmpl.il8n.filtering,b.sel=b.tmpl.sel.filtering,b.pushOrReplace=b.opt.pushOrReplace,b.type=b.opt.type,b.theme=b.opt.theme,b.position=b.opt.position,b.mode=b.opt.mode,b.sortBy=b.opt.sortBy,b.sortInvert=b.opt.sortInvert,b.min=b.opt.min,b.limit=b.opt.limit,b.showCount=b.opt.showCount,b.adjustSize=b.opt.adjustSize,b.smallest=b.opt.smallest,b.largest=b.opt.largest,b.adjustOpacity=b.opt.adjustOpacity,b.lightest=b.opt.lightest,b.darkest=b.opt.darkest,b.current=[],b.ctrls=[],b.tags=[],b.isMultiLevel=!1},fromHash:function(a){var b=this,c=b.tmpl.state.opt;return a.split(c.arraySeparator).map(function(a){return d.empty(a)?[]:a.split(c.array).map(function(a){return decodeURIComponent(a)})})},toHash:function(b){var c=this,e=c.tmpl.state.opt,f=null;return d.array(b)&&(f=a.map(b,function(b){return(d.array(b)?a.map(b,function(a){return d.undef(a)?"":encodeURIComponent(a)}):[]).join(e.array)}).join(e.arraySeparator)),d.empty(f)?null:f},getState:function(){return d.array(this.current)&&!this.current.every(function(a){return 0===a.length})?this.current.slice():null},setState:function(a){this.rebuild(),this.set(a.filter,!1)},destroy:function(){var b=this;b.tags.splice(0,b.tags.length),a.each(b.ctrls.splice(0,b.ctrls.length),function(a,b){b.destroy()}),b._super()},count:function(a,b){a=d.array(a)?a:[],b=d.array(b)?b:[];for(var e,f={__ALL__:0},g=0===b.length,h=0,i=a.length;h<i;h++)if(!d.empty(e=a[h].tags)){f.__ALL__++;for(var j,k=0,l=e.length;k<l;k++)d.empty(j=e[k])||!g&&(g||-1===c.inArray(j,b))||(d.number(f[j])?f[j]++:f[j]=1)}for(var m=0,n=b.length;m<n;m++)f.hasOwnProperty(b[m])||(f[b[m]]=0);return f},createTagObjects:function(a,b,d,e){var f=this,g=[],h=f.count(a,b),i=1/0,j=0,k=-1;for(var l in h)if(h.hasOwnProperty(l)){var m=h[l],n="__ALL__"===l;(f.min<=0||m>=f.min)&&(b.length>0?k=c.inArray(l,b):k++,g.push({level:d,index:k,value:n?"":l,text:n?e:l,count:m,percent:1,size:f.largest,opacity:f.darkest}),m<i&&(i=m),m>j&&(j=m))}if(f.limit>0&&g.length>f.limit&&(g.sort(function(a,b){return b.count-a.count}),g=g.slice(0,f.limit)),!f.isMultiLevel&&(!0===f.adjustSize||!0===f.adjustOpacity))for(var o,p=f.largest-f.smallest,q=f.darkest-f.lightest,r=0,s=g.length;r<s;r++)o=g[r],o.percent=(o.count-i)/(j-i),o.size=f.adjustSize?Math.round(p*o.percent+f.smallest):f.largest,o.opacity=f.adjustOpacity?q*o.percent+f.lightest:f.darkest;switch(f.sortBy){case"none":f.sort(g,"index",!1);break;default:f.sort(g,f.sortBy,f.sortInvert)}return g},showControl:function(){return!this.tags.every(function(a){return 0===a.length})},build:function(){var c=this,e=c.tmpl.items.all();if(c.isMultiLevel=c.opt.tags.length>0&&d.object(c.opt.tags[0]),e.length>0&&(c.isMultiLevel?a.each(c.opt.tags,function(a,b){c.tags.push(c.createTagObjects(e,b.tags,a,b.all||c.il8n.all))}):c.tags.push(c.createTagObjects(e,c.opt.tags,0,c.il8n.all))),c.showControl()&&b.filtering.hasCtrl(c.type)){var f,g,h=c.position;"both"!==h&&"top"!==h||(f=b.filtering.makeCtrl(c.type,c.tmpl,c,"top"),f.create()&&(f.append(),c.ctrls.push(f))),"both"!==h&&"bottom"!==h||(g=b.filtering.makeCtrl(c.type,c.tmpl,c,"bottom"),g.create()&&(g.append(),c.ctrls.push(g)))}},rebuild:function(){var b=this;b.tags.splice(0,b.tags.length),a.each(b.ctrls.splice(0,b.ctrls.length),function(a,b){b.destroy()}),b.build()},controls:function(b){var c=this;a.each(c.ctrls,function(a,c){c.update(b)})},hasAll:function(a,b){return b.every(function(b){return 0===b.length||d.array(a.tags)&&b.every(function(b){return-1!==a.tags.indexOf(b)})})},hasSome:function(a,b){return b.every(function(b){return 0===b.length||d.array(a.tags)&&b.some(function(b){return-1!==a.tags.indexOf(b)})})},set:function(b,c){d.string(b)&&(b=[[b]]),d.array(b)||(b=[]);var e,f=this;if(!f.arraysEqual(f.current,b)){var g=f.current.slice(),h=function(){if(c=!d.boolean(c)||c,c&&!f.tmpl.state.exists()&&(e=f.tmpl.state.get(),f.tmpl.state.update(e,f.pushOrReplace)),d.empty(b))f.tmpl.items.reset();else{var h=f.tmpl.items.all();h="intersect"===f.mode?a.map(h,function(a){return f.hasAll(a,b)?a:null}):a.map(h,function(a){return f.hasSome(a,b)?a:null}),f.tmpl.items.setAvailable(h)}f.current=b.slice(),f.controls(b),f.tmpl.pages?(f.tmpl.pages.rebuild(),f.tmpl.pages.set(1,null,null,!0)):(f.tmpl.items.detach(f.tmpl.items.all()),f.tmpl.items.create(f.tmpl.getAvailable(),!0)),c&&(e=f.tmpl.state.get(),f.tmpl.state.update(e,f.pushOrReplace)),f.tmpl.trigger("after-filter-change",[f.current,g])};return!f.tmpl.trigger("before-filter-change",[f.current,b,h]).isDefaultPrevented()&&(h(),!0)}return!1},arraysEqual:function(a,b){if(a.length!==b.length)return!1;a=a.slice(),b=b.slice(),a.sort(),b.sort();for(var c=a.length;c--;)if(a[c]!==b[c])return!1;return!0},sort:function(a,b,c){a.sort(function(a,e){if(a.hasOwnProperty(b)&&e.hasOwnProperty(b)){if(!d.string(a[b])||!d.string(e[b]))return c?e[b]-a[b]:a[b]-e[b];var f=a[b].toUpperCase(),g=e[b].toUpperCase();if(c){if(g<f)return-1;if(g>f)return 1}else{if(f<g)return-1;if(f>g)return 1}}return 0})},apply:function(a){var b=this;b.set(a,!b.tmpl.pages)}}),b.FilteringControl=b.Component.extend({construct:function(a,b,c){var d=this;d._super(a),d.filter=b,d.position=c,d.$container=null},create:function(){var b=this;return b.$container=a("#"+b.tmpl.id+"_filtering-"+b.position),b.$container.length>0?(b._containerExisted=!0,b.$container.removeClass(function(a,c){return b._placeholderClasses=c.match(/(^|\s)fg-ph-\S+/g)||[],b._placeholderClasses.join(" ")}).addClass([b.filter.cls.container,b.filter.theme].join(" "))):b.$container=a("<nav/>",{class:[b.filter.cls.container,b.filter.theme].join(" ")}),!0},destroy:function(){var a=this;a._containerExisted?a.$container.empty().removeClass().addClass(a._placeholderClasses.join(" ")):a.$container.remove(),a.$container=null},append:function(){var a=this;a._containerExisted||("top"===a.position?a.$container.insertBefore(a.tmpl.$el):a.$container.insertAfter(a.tmpl.$el))},update:function(a){}}),b.filtering.register("default",b.Filtering,null,{type:"none",theme:"fg-light",pushOrReplace:"push",position:"none",mode:"single",sortBy:"value",sortInvert:!1,tags:[],min:0,limit:0,showCount:!1,adjustSize:!1,adjustOpacity:!1,smallest:12,largest:16,lightest:.5,darkest:1},{container:"fg-filtering-container"},null,-100)}(FooGallery.$,FooGallery,FooGallery.utils,FooGallery.utils.is),function(a,b,c,d){b.Tags=b.Filtering.extend({}),b.TagsControl=b.FilteringControl.extend({construct:function(a,b,c){this._super(a,b,c),this.$container=null,this.lists=[]},create:function(){var a=this;if(a._super()){for(var b=a.filter.cls,c=0,d=a.filter.tags.length;c<d;c++)a.lists.push(a.createList(a.filter.tags[c]).appendTo(a.$container));return a.filter.isMultiLevel||!0!==a.filter.showCount||a.$container.addClass(b.showCount),!0}return!1},createList:function(b){for(var c=this,d=c.filter.cls,e=a("<ul/>",{class:d.list}),f=0,g=b.length;f<g;f++)e.append(c.createItem(b[f]).toggleClass(d.selected,0===f));return e},destroy:function(){var a=this,b=a.filter.sel;a.lists.forEach(function(c,d){c.find(b.link).off("click.foogallery",a.onLinkClick)}),a.lists=[],a._super()},update:function(b){var e=this,f=e.filter.cls,g=e.filter.sel;e.lists.forEach(function(e,h){e.find(g.item).removeClass(f.selected).each(function(){var e=a(this),g=e.data("tag");d.string(g)||(g+="");var i=d.empty(g);e.toggleClass(f.selected,i&&d.empty(b[h])||!i&&-1!==c.inArray(g,b[h]))})})},createItem:function(b){var c=this,e=c.filter.cls,f=a("<li/>",{class:e.item}).attr("data-tag",b.value),g=a("<a/>",{href:"#tag-"+b.value,class:e.link}).on("click.foogallery",{self:c,tag:b},c.onLinkClick).css("font-size",b.size).css("opacity",b.opacity).append(a("<span/>",{text:d.string(b.text)?b.text:b.value,class:e.text})).appendTo(f);return c.filter.isMultiLevel||!0!==c.filter.showCount||g.append(a("<span/>",{text:b.count,class:e.count})),f},onLinkClick:function(a){a.preventDefault();var b,e=a.data.self,f=a.data.tag,g=e.filter.current.map(function(a){return d.array(a)?a.slice():a});if(d.empty(f.value))g[f.level]=[];else switch(e.filter.mode){case"union":case"intersect":d.array(g[f.level])||(g[f.level]=[]),b=c.inArray(f.value,g[f.level]),-1===b?g[f.level].push(f.value):g[f.level].splice(b,1);break;case"single":default:g[f.level]=[f.value]}g.every(d.empty)&&(g=[]),e.filter.apply(g)}}),b.filtering.register("tags",b.Tags,b.TagsControl,{type:"tags",position:"top",pushOrReplace:"push"},{showCount:"fg-show-count",list:"fg-tag-list",item:"fg-tag-item",link:"fg-tag-link",text:"fg-tag-text",count:"fg-tag-count",selected:"fg-selected"},{all:"All",none:"No items found."},-100)}(FooGallery.$,FooGallery,FooGallery.utils,FooGallery.utils.is);