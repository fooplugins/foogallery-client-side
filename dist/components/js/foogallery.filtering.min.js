/*
* FooGallery - The Most Intuitive and Extensible Gallery Creation and Management Tool Ever Created for WordPress
* @version 2.0.40
* @link 
* @copyright Steven Usher & Brad Vincent 2015
* @license Released under the GPLv3 license.
*/
!function(t,u,p){t.FilteringFactory=t.Factory.extend({construct:function(){this.registered={}},register:function(t,e,r,n,l,a,s){e=this._super(t,e,s);return e&&((s=this.registered)[t].ctrl=u.fn(r)?r:null,s[t].opt=u.hash(n)?n:{},s[t].cls=u.hash(l)?l:{},s[t].il8n=u.hash(a)?a:{}),e},type:function(t){return u.hash(t)&&u.hash(t=t.filtering)&&u.string(t.type)&&this.contains(t.type)?t.type:null},merge:function(t){t=p.extend({},t);var e=this,r=e.type(t),n=e.registered,l=n.default.opt,a=n.default.cls,s=n.default.il8n,i=u.hash(t.filtering)?t.filtering:{},o=u.hash(t.cls)&&u.hash(t.cls.filtering)?p.extend({},t.cls.filtering):{},c=u.hash(t.il8n)&&u.hash(t.il8n.filtering)?p.extend({},t.il8n.filtering):{};return u.hash(t.cls)||(t.cls={}),u.hash(t.il8n)||(t.il8n={}),"default"!==r&&e.contains(r)?(t.filtering=p.extend({},l,n[r].opt,i,{type:r}),t.cls=p.extend(t.cls,{filtering:a},{filtering:n[r].cls},{filtering:o}),t.il8n=p.extend(t.il8n,{filtering:s},{filtering:n[r].il8n},{filtering:c})):(t.filtering=p.extend({},l,i,{type:r}),t.cls=p.extend(t.cls,{filtering:a},{filtering:o}),t.il8n=p.extend(t.il8n,{filtering:s},{filtering:c})),t},hasCtrl:function(t){t=this.registered[t];return u.hash(t)&&u.fn(t.ctrl)},makeCtrl:function(t,e,r,n){t=this.registered[t];return u.hash(t)&&u.fn(t.ctrl)?new t.ctrl(e,r,n):null}}),t.filtering=new t.FilteringFactory}(FooGallery,FooGallery.utils.is,(FooGallery.utils.fn,FooGallery.utils.obj)),function(u,a,v,h,p){a.Filtering=a.Component.extend({construct:function(t){var e=this;e._super(t),e.opt=e.tmpl.opt.filtering,e.cls=e.tmpl.cls.filtering,e.il8n=e.tmpl.il8n.filtering,e.sel=e.tmpl.sel.filtering,e.pushOrReplace=e.opt.pushOrReplace,e.type=e.opt.type,e.theme=e.opt.theme,e.position=e.opt.position,e.mode=e.opt.mode,e.sortBy=e.opt.sortBy,e.sortInvert=e.opt.sortInvert,e.min=e.opt.min,e.limit=e.opt.limit,e.showCount=e.opt.showCount,e.noAll=e.opt.noAll,e.autoSelected=e.opt.autoSelected,e.adjustSize=e.opt.adjustSize,e.smallest=e.opt.smallest,e.largest=e.opt.largest,e.adjustOpacity=e.opt.adjustOpacity,e.lightest=e.opt.lightest,e.darkest=e.opt.darkest,e.current=[],e.ctrls=[],e.tags=[],e.search="",e.isMultiLevel=!1},fromHash:function(t){var e=this.tmpl.state.opt;return t.split(e.arraySeparator).map(function(t){return h.empty(t)?[]:t.split(e.array).map(function(t){return decodeURIComponent(t)})})},toHash:function(t){var e=this.tmpl.state.opt,r=null;return h.array(t)&&(r=u.map(t,function(t){return(h.array(t)?u.map(t,function(t){return h.undef(t)?"":encodeURIComponent(t)}):[]).join(e.array)}).join(e.arraySeparator)),h.empty(r)?null:r},getState:function(){return h.array(this.current)&&!this.current.every(function(t){return 0===t.length})?this.current.slice():null},setState:function(t){var e=this,r=(e.rebuild(),t.filter);if(e.autoSelected&&(!h.array(t.filter)||0===t.filter.length)&&0<e.tags.length)for(var r=[],n=0;n<e.tags.length;n++)h.array(e.tags[n])&&(0===n?r.push([e.tags[n][0].value]):r.push([]));e.set(r,"",!1)},destroy:function(){var t=this;t.tags.splice(0,t.tags.length),u.each(t.ctrls.splice(0,t.ctrls.length),function(t,e){e.destroy()}),t._super()},count:function(t,e){t=h.array(t)?t:[];for(var r,n={__ALL__:0},l=0===(e=h.array(e)?e:[]).length,a=0,s=t.length;a<s;a++)if(!h.empty(r=t[a].tags)){n.__ALL__++;for(var i,o=0,c=r.length;o<c;o++)h.empty(i=r[o])||!l&&-1===v.inArray(i,e)||(h.number(n[i])?n[i]++:n[i]=1)}for(var u=0,p=e.length;u<p;u++)n.hasOwnProperty(e[u])||(n[e[u]]=0);return n},createTagObjects:function(t,e,r,n){var l,a,s=this,i=[],o=s.count(t,e),c=1/0,u=0,p=-1;if(0!==o.__ALL__){for(var h in o)o.hasOwnProperty(h)&&(l=o[h],a="__ALL__"===h,s.noAll&&a||(s.min<=0||l>=s.min)&&(0<e.length?p=v.inArray(h,e):p++,i.push({level:r,index:p,value:a?"":h,text:a?n:h,count:l,percent:1,size:s.largest,opacity:s.darkest}),l<c&&(c=l),u<l&&(u=l)));if(0<s.limit&&i.length>s.limit&&(i.sort(function(t,e){return e.count-t.count}),i=i.slice(0,s.limit)),!s.isMultiLevel&&(!0===s.adjustSize||!0===s.adjustOpacity))for(var f,g=s.largest-s.smallest,d=s.darkest-s.lightest,m=0,y=i.length;m<y;m++)(f=i[m]).percent=(f.count-c)/(u-c),f.size=s.adjustSize?Math.round(g*f.percent+s.smallest):s.largest,f.opacity=s.adjustOpacity?d*f.percent+s.lightest:s.darkest;"none"===s.sortBy?s.sort(i,"index",!1):s.sort(i,s.sortBy,s.sortInvert)}return i},showControl:function(){return this.opt.search||!this.tags.every(function(t){return 0===t.length})},build:function(t){var r,e,n=this,l=t?n.tmpl.items.available():n.tmpl.items.all();n.isMultiLevel=0<n.opt.tags.length&&h.object(n.opt.tags[0]),0<l.length&&(n.isMultiLevel?u.each(n.opt.tags,function(t,e){r=n.createTagObjects(l,e.tags,t,e.all||n.il8n.all),h.empty(r)||n.tags.push(r)}):(r=n.createTagObjects(l,n.opt.tags,0,n.il8n.all),h.empty(r)||n.tags.push(r))),n.showControl()&&a.filtering.hasCtrl(n.type)&&("both"!==(t=n.position)&&"top"!==t||(e=a.filtering.makeCtrl(n.type,n.tmpl,n,"top")).create()&&(e.append(),n.ctrls.push(e)),"both"!==t&&"bottom"!==t||(e=a.filtering.makeCtrl(n.type,n.tmpl,n,"bottom")).create()&&(e.append(),n.ctrls.push(e)))},rebuild:function(t){var e=this;e.tags.splice(0,e.tags.length),u.each(e.ctrls.splice(0,e.ctrls.length),function(t,e){e.destroy()}),e.build(t)},controls:function(r,n){u.each(this.ctrls,function(t,e){e.update(r,n)})},hasAll:function(e,t){return t.every(function(t){return 0===t.length||h.array(e.tags)&&t.every(function(t){return-1!==e.tags.indexOf(t)})})},hasSome:function(e,t){return t.every(function(t){return 0===t.length||h.array(e.tags)&&t.some(function(t){return-1!==e.tags.indexOf(t)})})},isMatch:function(t,e){return h.string(t.title)&&e.test(t.title)||h.string(t.alt)&&e.test(t.alt)||h.string(t.caption)&&e.test(t.caption)||h.string(t.description)&&e.test(t.description)||h.array(t.tags)&&t.tags.some(function(t){return e.test(t)})},set:function(l,a,s){h.string(l)&&(l=[[l]]),h.array(l)||(l=[]);var i,o,t,c=this;return(!c.arraysEqual(c.current,l)||c.search!==a)&&(o=c.current.slice(),!c.tmpl.trigger("before-filter-change",[c.current,l,t=function(){(s=!h.boolean(s)||s)&&!c.tmpl.state.exists()&&(i=c.tmpl.state.get(),c.tmpl.state.update(i,c.pushOrReplace));var e,t,r=c.search!==a,n=h.empty(a);h.empty(l)&&n?c.tmpl.items.reset():(t=c.tmpl.items.all(),n||(e=new RegExp(p.escapeRegExp(a),"i"),t=u.map(t,function(t){return c.isMatch(t,e)?t:null})),t="intersect"===c.mode?u.map(t,function(t){return c.hasAll(t,l)?t:null}):u.map(t,function(t){return c.hasSome(t,l)?t:null}),c.tmpl.items.setAvailable(t)),c.current=l.slice(),c.search=a,r?c.rebuild(!n):c.controls(c.current,c.search),c.tmpl.pages?(c.tmpl.pages.rebuild(),c.tmpl.pages.set(1,null,null,!0)):(c.tmpl.items.detach(c.tmpl.items.all()),c.tmpl.items.create(c.tmpl.getAvailable(),!0)),s&&(i=c.tmpl.state.get(),c.tmpl.state.update(i,c.pushOrReplace)),c.tmpl.trigger("after-filter-change",[c.current,o])}]).isDefaultPrevented()&&(t(),!0))},arraysEqual:function(t,e){if(t.length!==e.length)return!1;t=t.slice(),e=e.slice(),t.sort(),e.sort();for(var r=t.length;r--;)if(t[r]!==e[r])return!1;return!0},sort:function(t,r,n){t.sort(function(t,e){if(t.hasOwnProperty(r)&&e.hasOwnProperty(r)){if(!h.string(t[r])||!h.string(e[r]))return n?e[r]-t[r]:t[r]-e[r];t=t[r].toUpperCase(),e=e[r].toUpperCase();if(n){if(e<t)return-1;if(t<e)return 1}else{if(t<e)return-1;if(e<t)return 1}}return 0})},apply:function(t,e){this.set(t,e,!this.tmpl.pages)}}),a.FilteringControl=a.Component.extend({construct:function(t,e,r){this._super(t),this.filter=e,this.position=r,this.$container=null},create:function(){var r=this;return r.$container=u("#"+r.tmpl.id+"_filtering-"+r.position),0<r.$container.length?(r._containerExisted=!0,r.$container.removeClass(function(t,e){return r._placeholderClasses=e.match(/(^|\s)fg-ph-\S+/g)||[],r._placeholderClasses.join(" ")}).addClass([r.filter.cls.container,r.filter.theme].join(" "))):r.$container=u("<nav/>",{class:[r.filter.cls.container,r.filter.theme].join(" ")}),!0},destroy:function(){var t=this;t._containerExisted?t.$container.empty().removeClass().addClass(t._placeholderClasses.join(" ")):t.$container.remove(),t.$container=null},append:function(){var t=this;t._containerExisted||("top"===t.position?t.$container.insertBefore(t.tmpl.$el):t.$container.insertAfter(t.tmpl.$el))},update:function(t){}}),a.filtering.register("default",a.Filtering,null,{type:"none",theme:"fg-light",pushOrReplace:"push",position:"none",mode:"single",sortBy:"value",sortInvert:!1,search:!1,noAll:!1,autoSelected:!1,tags:[],min:0,limit:0,showCount:!1,adjustSize:!1,adjustOpacity:!1,smallest:12,largest:16,lightest:.5,darkest:1},{container:"fg-filtering-container"},null,-100)}(FooGallery.$,FooGallery,FooGallery.utils,FooGallery.utils.is,FooGallery.utils.str),function(s,l,i,o){l.Tags=l.Filtering.extend({}),l.TagsControl=l.FilteringControl.extend({construct:function(t,e,r){this._super(t,e,r),this.$container=null,this.searchEnabled="top"===this.position&&this.filter.opt.search,this.search={$wrap:null,$inner:null,$input:null,$clear:null,$submit:null},this.lists=[]},create:function(){var t=this;if(t._super()){var e=t.filter.cls;if(t.searchEnabled&&(t.$container.append(t.createSearch(t.filter.search)),o.empty(t.filter.opt.searchPosition)||t.$container.addClass("fg-search-"+t.filter.opt.searchPosition)),0<t.filter.tags.length){for(var r=0,n=t.filter.tags.length;r<n;r++)t.lists.push(t.createList(t.filter.tags[r]).appendTo(t.$container));t.filter.isMultiLevel||!0!==t.filter.showCount||t.$container.addClass(e.showCount)}else t.$container.addClass(e.noTags);return!0}return!1},createSearch:function(t){var e=this,r=e.filter.cls.search,n=e.filter.il8n;return e.search.$wrap=s("<div/>",{class:r.wrap}),e.search.$inner=s("<div/>",{class:r.inner}).appendTo(e.search.$wrap),e.search.$input=s("<input/>",{type:"text",class:r.input,placeholder:n.searchPlaceholder}).on("input.foogallery",{self:e},e.onSearchInput).on("keydown.foogallery",{self:e},e.onSearchKeydown).appendTo(e.search.$inner),e.search.$clear=s("<button/>",{type:"button",class:r.clear}).append(s("<span/>",{class:r.reader,text:n.searchClear})).append(l.icons.get("close")).on("click.foogallery",{self:e},e.onSearchClear).appendTo(e.search.$inner),e.search.$submit=s("<button/>",{type:"button",class:r.submit}).append(s("<span/>",{class:r.reader,text:n.searchSubmit})).append(l.icons.get("search")).on("click.foogallery",{self:e},e.onSearchSubmit).appendTo(e.search.$inner),o.empty(t)||(e.search.$wrap.addClass(r.hasValue),e.search.$input.val(t).attr("placeholder",t)),e.search.$wrap},createList:function(t){for(var e=this.filter.cls,r=s("<ul/>",{class:e.list}),n=0,l=t.length;n<l;n++){var a=this.createItem(t[n]);r.append(a.toggleClass(e.selected,0===n&&(this.filter.autoSelected||o.empty(t[n].value))))}return r},destroy:function(){var r=this,n=r.filter.sel;r.lists.forEach(function(t,e){t.find(n.link).off("click.foogallery",r.onLinkClick)}),r.lists=[],r._super()},update:function(l,t){var e=this,a=e.filter.cls,r=e.filter.sel;e.searchEnabled&&(e.search.$wrap.toggleClass(a.search.hasValue,!o.empty(t)),e.search.$input.val(t)),e.lists.forEach(function(t,n){t.find(r.item).removeClass(a.selected).each(function(){var t=s(this),e=t.data("tag")+"",r=o.empty(e),r=r&&o.empty(l[n])||!r&&-1!==i.inArray(e,l[n]);t.toggleClass(a.selected,r)})})},createItem:function(t){var e=this,r=e.filter.cls,n=s("<li/>",{class:r.item}).attr("data-tag",t.value),l=s("<span/>").addClass(r.text).html(o.string(t.text)?t.text:t.value),l=s("<a/>",{href:"#tag-"+t.value,class:r.link}).on("click.foogallery",{self:e,tag:t},e.onLinkClick).css("font-size",t.size).css("opacity",t.opacity).append(l).appendTo(n);return e.filter.isMultiLevel||!0!==e.filter.showCount||l.append(s("<span/>",{text:t.count,class:r.count})),n},onLinkClick:function(t){t.preventDefault();var e,r=t.data.self,n=t.data.tag,l=r.filter.current.map(function(t){return o.array(t)?t.slice():t});if(o.empty(n.value))l[n.level]=[];else switch(r.filter.mode){case"union":case"intersect":o.array(l[n.level])||(l[n.level]=[]),-1===(e=i.inArray(n.value,l[n.level]))?l[n.level].push(n.value):l[n.level].splice(e,1);break;default:l[n.level]=[n.value]}l.every(o.empty)&&(l=[]),r.filter.apply(l,r.filter.search)},onSearchInput:function(t){var t=t.data.self,e=t.filter.cls.search,r=!o.empty(t.search.$input.val())||t.search.$input.attr("placeholder")!==t.filter.il8n.searchPlaceholder;t.search.$wrap.toggleClass(e.hasValue,r)},onSearchKeydown:function(t){13===t.which&&(t=t.data.self).filter.apply([],t.search.$input.val())},onSearchClear:function(t){t.preventDefault();t=t.data.self;t.search.$wrap.removeClass(t.filter.cls.search.hasValue),t.search.$input.val(""),t.search.$input.attr("placeholder")!==t.filter.il8n.searchPlaceholder&&t.filter.apply([],"")},onSearchSubmit:function(t){t.preventDefault();t=t.data.self;t.filter.apply([],t.search.$input.val())}}),l.filtering.register("tags",l.Tags,l.TagsControl,{type:"tags",position:"top",pushOrReplace:"push",searchPosition:"above-center"},{showCount:"fg-show-count",noTags:"fg-no-tags",list:"fg-tag-list",item:"fg-tag-item",link:"fg-tag-link",text:"fg-tag-text",count:"fg-tag-count",selected:"fg-selected",search:{wrap:"fg-search-wrap",inner:"fg-search-inner",input:"fg-search-input",clear:"fg-search-clear",submit:"fg-search-submit",hasValue:"fg-search-has-value",reader:"fg-sr-only"}},{all:"All",none:"No items found.",searchPlaceholder:"Search gallery...",searchSubmit:"Submit search",searchClear:"Clear search"},-100)}(FooGallery.$,FooGallery,FooGallery.utils,FooGallery.utils.is);