/*
* FooGallery - The Most Intuitive and Extensible Gallery Creation and Management Tool Ever Created for WordPress
* @version 2.1.7
* @link 
* @copyright Steven Usher & Brad Vincent 2015
* @license Released under the GPLv3 license.
*/
!function(t,p,h){t.FilteringFactory=t.Factory.extend({construct:function(){this.registered={}},register:function(t,e,s,n,a,r,l){e=this._super(t,e,l);return e&&((l=this.registered)[t].ctrl=p.fn(s)?s:null,l[t].opt=p.hash(n)?n:{},l[t].cls=p.hash(a)?a:{},l[t].il8n=p.hash(r)?r:{}),e},type:function(t){return p.hash(t)&&p.hash(t=t.filtering)&&p.string(t.type)&&this.contains(t.type)?t.type:null},merge:function(t){t=h.extend({},t);var e=this,s=e.type(t),n=e.registered,a=n.default.opt,r=n.default.cls,l=n.default.il8n,i=p.hash(t.filtering)?t.filtering:{},o=p.hash(t.cls)&&p.hash(t.cls.filtering)?h.extend({},t.cls.filtering):{},c=p.hash(t.il8n)&&p.hash(t.il8n.filtering)?h.extend({},t.il8n.filtering):{};return p.hash(t.cls)||(t.cls={}),p.hash(t.il8n)||(t.il8n={}),"default"!==s&&e.contains(s)?(t.filtering=h.extend({},a,n[s].opt,i,{type:s}),t.cls=h.extend(t.cls,{filtering:r},{filtering:n[s].cls},{filtering:o}),t.il8n=h.extend(t.il8n,{filtering:l},{filtering:n[s].il8n},{filtering:c})):(t.filtering=h.extend({},a,i,{type:s}),t.cls=h.extend(t.cls,{filtering:r},{filtering:o}),t.il8n=h.extend(t.il8n,{filtering:l},{filtering:c})),t},hasCtrl:function(t){t=this.registered[t];return p.hash(t)&&p.fn(t.ctrl)},makeCtrl:function(t,e,s,n){t=this.registered[t];return p.hash(t)&&p.fn(t.ctrl)?new t.ctrl(e,s,n):null}}),t.filtering=new t.FilteringFactory}(FooGallery,FooGallery.utils.is,(FooGallery.utils.fn,FooGallery.utils.obj)),function(p,r,v,u,h){r.Filtering=r.Component.extend({construct:function(t){var e=this;e._super(t),e.opt=e.tmpl.opt.filtering,e.cls=e.tmpl.cls.filtering,e.il8n=e.tmpl.il8n.filtering,e.sel=e.tmpl.sel.filtering,e.pushOrReplace=e.opt.pushOrReplace,e.type=e.opt.type,e.theme=e.opt.theme??t.getCSSClass("theme"),e.position=e.opt.position,e.mode=e.opt.mode,e.sortBy=e.opt.sortBy,e.sortInvert=e.opt.sortInvert,e.min=e.opt.min,e.limit=e.opt.limit,e.showCount=e.opt.showCount,e.noAll=e.opt.noAll,e.autoSelected=e.opt.autoSelected,e.adjustSize=e.opt.adjustSize,e.smallest=e.opt.smallest,e.largest=e.opt.largest,e.adjustOpacity=e.opt.adjustOpacity,e.lightest=e.opt.lightest,e.darkest=e.opt.darkest,e.current=[],e.ctrls=[],e.tags=[],e.search="",e.isMultiLevel=!1},fromHash:function(t){var e=this.tmpl.state.opt;return t.split(e.arraySeparator).map(function(t){return u.empty(t)?[]:t.split(e.array).map(function(t){return decodeURIComponent(t)})})},toHash:function(t){var e=this.tmpl.state.opt,s=null;return u.array(t)&&(s=p.map(t,function(t){return(u.array(t)?p.map(t,function(t){return u.undef(t)?"":encodeURIComponent(t)}):[]).join(e.array)}).join(e.arraySeparator)),u.empty(s)?null:s},getState:function(){return u.array(this.current)&&!this.current.every(function(t){return 0===t.length})?this.current.slice():null},setState:function(t){var e=this,s=(e.rebuild(),t.filter);if(e.autoSelected&&(!u.array(t.filter)||0===t.filter.length)&&0<e.tags.length)for(var s=[],n=0;n<e.tags.length;n++)u.array(e.tags[n])&&(0===n?s.push([e.tags[n][0].value]):s.push([]));e.set(s,"",!1)},destroy:function(){var t=this;t.tags.splice(0,t.tags.length),p.each(t.ctrls.splice(0,t.ctrls.length),function(t,e){e.destroy()}),t._super()},count:function(t,e){t=u.array(t)?t:[];for(var s,n={__ALL__:0},a=0===(e=u.array(e)?e:[]).length,r=0,l=t.length;r<l;r++)if(!u.empty(s=t[r].tags)){n.__ALL__++;for(var i,o=0,c=s.length;o<c;o++)u.empty(i=s[o])||!a&&-1===v.inArray(i,e)||(u.number(n[i])?n[i]++:n[i]=1)}for(var p=0,h=e.length;p<h;p++)n.hasOwnProperty(e[p])||(n[e[p]]=0);return n},createTagObjects:function(t,e,s,n){var a,r,l=this,i=[],o=l.count(t,e),c=1/0,p=0,h=-1;if(0!==o.__ALL__){for(var u in o)o.hasOwnProperty(u)&&(a=o[u],r="__ALL__"===u,l.noAll&&r||(l.min<=0||a>=l.min)&&(0<e.length?h=v.inArray(u,e):h++,i.push({level:s,index:h,value:r?"":u,text:r?n:u,count:a,percent:1,size:l.largest,opacity:l.darkest}),a<c&&(c=a),p<a&&(p=a)));if(0<l.limit&&i.length>l.limit&&(i.sort(function(t,e){return e.count-t.count}),i=i.slice(0,l.limit)),!l.isMultiLevel&&(!0===l.adjustSize||!0===l.adjustOpacity))for(var d,f=l.largest-l.smallest,g=l.darkest-l.lightest,m=0,y=i.length;m<y;m++)(d=i[m]).percent=(d.count-c)/(p-c),d.size=l.adjustSize?Math.round(f*d.percent+l.smallest):l.largest,d.opacity=l.adjustOpacity?g*d.percent+l.lightest:l.darkest;"none"===l.sortBy?l.sort(i,"index",!1):l.sort(i,l.sortBy,l.sortInvert)}return i},showControl:function(){return this.opt.search||!this.tags.every(function(t){return 0===t.length})},build:function(t){var s,e,n=this,a=t?n.tmpl.items.available():n.tmpl.items.all();n.isMultiLevel=0<n.opt.tags.length&&u.object(n.opt.tags[0]),0<a.length&&(n.isMultiLevel?p.each(n.opt.tags,function(t,e){s=n.createTagObjects(a,e.tags,t,e.all||n.il8n.all),u.empty(s)||n.tags.push(s)}):(s=n.createTagObjects(a,n.opt.tags,0,n.il8n.all),u.empty(s)||n.tags.push(s))),n.showControl()&&r.filtering.hasCtrl(n.type)&&("both"!==(t=n.position)&&"top"!==t||(e=r.filtering.makeCtrl(n.type,n.tmpl,n,"top")).create()&&(e.append(),n.ctrls.push(e)),"both"!==t&&"bottom"!==t||(e=r.filtering.makeCtrl(n.type,n.tmpl,n,"bottom")).create()&&(e.append(),n.ctrls.push(e)))},rebuild:function(t){var e=this;e.tags.splice(0,e.tags.length),p.each(e.ctrls.splice(0,e.ctrls.length),function(t,e){e.destroy()}),e.build(t)},controls:function(s,n){p.each(this.ctrls,function(t,e){e.update(s,n)})},hasAll:function(e,t){return t.every(function(t){return 0===t.length||u.array(e.tags)&&t.every(function(t){return-1!==e.tags.indexOf(t)})})},hasSome:function(e,t){return t.every(function(t){return 0===t.length||u.array(e.tags)&&t.some(function(t){return-1!==e.tags.indexOf(t)})})},isMatch:function(t,e){return u.string(t.title)&&e.test(t.title)||u.string(t.alt)&&e.test(t.alt)||u.string(t.caption)&&e.test(t.caption)||u.string(t.description)&&e.test(t.description)||u.array(t.tags)&&t.tags.some(function(t){return e.test(t)})},set:function(a,r,l){u.string(a)&&(a=[[a]]),u.array(a)||(a=[]);var i,o,t,c=this;return(!c.arraysEqual(c.current,a)||c.search!==r)&&(o=c.current.slice(),!c.tmpl.trigger("before-filter-change",[c.current,a,t=function(){(l=!u.boolean(l)||l)&&!c.tmpl.state.exists()&&(i=c.tmpl.state.get(),c.tmpl.state.update(i,c.pushOrReplace));var e,t,s=c.search!==r,n=u.empty(r);u.empty(a)&&n?c.tmpl.items.reset():(t=c.tmpl.items.all(),n||(e=new RegExp(h.escapeRegExp(r),"i"),t=p.map(t,function(t){return c.isMatch(t,e)?t:null})),t="intersect"===c.mode?p.map(t,function(t){return c.hasAll(t,a)?t:null}):p.map(t,function(t){return c.hasSome(t,a)?t:null}),c.tmpl.items.setAvailable(t)),c.current=a.slice(),c.search=r,s?c.rebuild(!n):c.controls(c.current,c.search),c.tmpl.pages?(c.tmpl.pages.rebuild(),c.tmpl.pages.set(1,null,null,!0)):(c.tmpl.items.detach(c.tmpl.items.all()),c.tmpl.items.create(c.tmpl.getAvailable(),!0)),l&&(i=c.tmpl.state.get(),c.tmpl.state.update(i,c.pushOrReplace)),c.tmpl.trigger("after-filter-change",[c.current,o])}]).isDefaultPrevented()&&(t(),!0))},arraysEqual:function(t,e){if(t.length!==e.length)return!1;t=t.slice(),e=e.slice(),t.sort(),e.sort();for(var s=t.length;s--;)if(t[s]!==e[s])return!1;return!0},sort:function(t,a,r){t.sort(function(t,e){var s,n;return t.hasOwnProperty(a)&&e.hasOwnProperty(a)?u.string(t[a])&&u.string(e[a])?(s=t[a],n=e[a],r?n.localeCompare(s):s.localeCompare(n)):r?e[a]-t[a]:t[a]-e[a]:0})},apply:function(t,e){this.set(t,e,!this.tmpl.pages)}}),r.FilteringControl=r.Component.extend({construct:function(t,e,s){this._super(t),this.filter=e,this.position=s,this.$container=null},create:function(){var s=this;return s.$container=p("#"+s.tmpl.id+"_filtering-"+s.position),0<s.$container.length?(s._containerExisted=!0,s.$container.removeClass(function(t,e){return s._placeholderClasses=e.match(/(^|\s)fg-ph-\S+/g)||[],s._placeholderClasses.join(" ")}).addClass([s.filter.cls.container,s.filter.theme].join(" "))):s.$container=p("<nav/>",{class:[s.filter.cls.container,s.filter.theme].join(" ")}),s.$container.css("--fg-base-size",s.filter.largest+"px").toggleClass("fg-multi-level",s.filter.isMultiLevel),!0},destroy:function(){var t=this;t._containerExisted?t.$container.empty().removeClass().addClass(t._placeholderClasses.join(" ")):t.$container.remove(),t.$container=null},append:function(){var t=this;t._containerExisted||("top"===t.position?t.$container.insertBefore(t.tmpl.$el):t.$container.insertAfter(t.tmpl.$el))},update:function(t){}}),r.filtering.register("default",r.Filtering,null,{type:"none",theme:null,pushOrReplace:"push",position:"none",mode:"single",sortBy:"value",sortInvert:!1,search:!1,noAll:!1,autoSelected:!1,tags:[],min:0,limit:0,showCount:!1,adjustSize:!1,adjustOpacity:!1,smallest:12,largest:16,lightest:.5,darkest:1},{container:"fg-filtering-container"},null,-100)}(FooGallery.$,FooGallery,FooGallery.utils,FooGallery.utils.is,FooGallery.utils.str),function(p,l,i,h){l.Tags=l.Filtering.extend({construct:function(t){this._super(t),(this.hideTopTags=this.opt.search&&"bottom"===this.position)&&(this.position="both")}}),l.TagsControl=l.FilteringControl.extend({construct:function(t,e,s){this._super(t,e,s),this.$container=null,this.$wrap=null,this.searchEnabled="top"===this.position&&this.filter.opt.search,this.search={$wrap:null,$inner:null,$input:null,$clear:null,$submit:null},this.lists=[],this.dropdownEnabled=this.isDropdownStyle(),this.collapseEnabled=this.filter.opt.collapse,this.collapse=null,this.onCollapseChange=this.onCollapseChange.bind(this),this._wrappedAt=0,this.onLayout=this.onLayout.bind(this)},isDropdownStyle:function(){return["dropdown","dropdown-block"].includes(this?.filter?.opt?.style)},shouldRenderTags:function(){return("bottom"===this.position||"top"===this.position&&!this.filter.hideTopTags)&&0<this.filter.tags.length},create:function(){if(this._super()){const{cls:t,opt:e,search:s,tags:n,isMultiLevel:a,showCount:r}=this["filter"];if(this.searchEnabled&&(this.$container.append(this.createSearch(s)),h.empty(e.searchPosition)||this.$container.addClass("fg-search-"+e.searchPosition)),this.$container.addClass("fg-tags-"+e.align),h.string(e.style)&&this.$container.addClass("fg-style-"+e.style),this.shouldRenderTags()){this.collapseEnabled&&(this.collapse=matchMedia("(max-width: 600px)"),this.collapse.addEventListener("change",this.onCollapseChange),this.dropdownEnabled=this.isDropdownStyle()||this.collapse.matches),this.$wrap=this.createWrap().appendTo(this.$container);let s=this.$wrap;this.dropdownEnabled&&(s=p("<div/>",{class:t.dropdown.wrap}).appendTo(this.$wrap)),n.forEach((t,e)=>this.lists.push(this.createList(t,e).appendTo(s))),a||!0!==r||this.$container.addClass(t.showCount),this.tmpl.on("layout",this.onLayout)}else this.$container.addClass(t.noTags);return!0}return!1},createSearch:function(t){var e=this,s=e.filter.cls.search,n=e.filter.il8n;return e.search.$wrap=p("<div/>",{class:s.wrap}),e.search.$inner=p("<div/>",{class:s.inner}).appendTo(e.search.$wrap),e.search.$input=p("<input/>",{type:"text",class:s.input,placeholder:n.searchPlaceholder,name:e.tmpl.id+"__search"}).on("input.foogallery",{self:e},e.onSearchInput).on("keydown.foogallery",{self:e},e.onSearchKeydown).appendTo(e.search.$inner),e.search.$clear=p("<button/>",{type:"button",class:s.clear}).append(p("<span/>",{class:s.reader,text:n.searchClear})).append(l.icons.get("close")).on("click.foogallery",{self:e},e.onSearchClear).appendTo(e.search.$inner),e.search.$submit=p("<button/>",{type:"button",class:s.submit}).append(p("<span/>",{class:s.reader,text:n.searchSubmit})).append(l.icons.get("search")).on("click.foogallery",{self:e},e.onSearchSubmit).appendTo(e.search.$inner),h.empty(t)||(e.search.$wrap.addClass(s.hasValue),e.search.$input.val(t).attr("placeholder",t)),e.search.$wrap},createWrap:function(){return p("<div/>",{class:this.filter.cls.wrap})},createList:function(t,e){const s=this;let n,a;var r=s.filter.cls;return s.dropdownEnabled?(n=p("<label/>",{class:r.dropdown.item}).append(p("<span/>").addClass(r.dropdown.icon).append(l.icons.get("arrow-down"))),a=p("<select/>",{class:r.dropdown.select,name:s.tmpl.id+"__tags-"+e}).on("change.foogallery",{self:s},s.onDropdownChange).prependTo(n)):n=a=p("<ul/>",{class:r.list}),t.forEach((t,e)=>a.append(s.createItem(t,((t,e)=>0===e&&(s.filter.autoSelected||h.empty(t?.value)))(t,e)))),n},onCollapseChange:function(){var t=this.dropdownEnabled;this.dropdownEnabled=this.isDropdownStyle()||this.collapse.matches,this.dropdownEnabled!==t&&this.recreateLists(t)},destroyLists:function(e){const s=this.filter["sel"];this.lists.forEach(t=>{e?t.find(s.dropdown.select).off("change.foogallery",this.onDropdownChange):t.find(s.link).off("click.foogallery",this.onLinkClick),t.remove()}),this.$wrap?.empty(),this.lists=[]},recreateLists:function(t){var e=this.filter["cls"];this.destroyLists(t);let s=this.$wrap;this.dropdownEnabled&&(s=p("<div/>",{class:e.dropdown.wrap}).appendTo(this.$wrap)),this.filter.tags.forEach((t,e)=>this.lists.push(this.createList(t,e).appendTo(s))),this.update(this.filter.current,this.filter.search)},destroy:function(){this.destroyLists(this.dropdownEnabled),this.tmpl.off("layout",this.onLayout),this._super()},update:function(a,t){var e=this,r=e.filter.cls,s=e.filter.sel;e.searchEnabled&&(e.search.$wrap.toggleClass(r.search.hasValue,!h.empty(t)),e.search.$input.val(t)),e.lists.forEach(function(t,n){e.dropdownEnabled?h.empty(a[n])?t.find(s.dropdown.select).val(""):t.find(s.dropdown.select).val(1===a[n].length?a[n][0]:a[n]):t.find(s.item).removeClass(r.selected).each(function(){var t=p(this),e=t.data("tag")+"",s=h.empty(e),s=s&&h.empty(a[n])||!s&&-1!==i.inArray(e,a[n]);t.toggleClass(r.selected,s)})})},createItem:function(t,e){var{dropdownEnabled:s,filter:{cls:n,isMultiLevel:a,showCount:r}}=this;if(s){const l=p("<option/>",{value:t.value,text:h.string(t.text)?t.text:t.value}).data("tagObject",t);return e&&l.attr("selected",""),l}{const i=p("<li/>",{class:n.item}).attr("data-tag",t.value),o=p("<span/>",{class:n.text}).html(h.string(t.text)?t.text:t.value),c=p("<a/>",{href:"#tag-"+t.value,class:n.link}).on("click.foogallery",{self:this,tag:t},this.onLinkClick).css("font-size",t.size).css("opacity",t.opacity).append(o).appendTo(i);return e&&i.addClass(n.selected),a||!0!==r||c.append(p("<span/>",{text:t.count,class:n.count})),i}},toggleTag:function(e){if(h.object(e)){const{current:n,mode:a,search:r}=this.filter;let t=n.map(t=>h.array(t)?t.slice():t);if(h.empty(e.value))t[e.level]=[];else switch(a){case"union":case"intersect":h.array(t[e.level])||(t[e.level]=[]);var s=i.inArray(e.value,t[e.level]);-1===s?t[e.level].push(e.value):t[e.level].splice(s,1);break;default:t[e.level]=[e.value]}t.every(h.empty)&&(t=[]),this.filter.apply(t,r)}},onDropdownChange:function(t){var e=t.target.querySelector(`[value="${t.target.value}"]`);t.data.self.toggleTag(p(e).data("tagObject"))},onLinkClick:function(t){t.preventDefault(),t.data.self.toggleTag(t.data.tag)},onLayout:function(t,e){var n=this;if(n.dropdownEnabled)n.lists.forEach(t=>t.removeClass("fg-wrapped")),n.$container.removeClass("fg-has-wrapped"),n._wrappedAt=0;else{let s=!1;n.lists.forEach(t=>{var e=t.get(0),e=e?.lastElementChild?.offsetTop!==e?.firstElementChild?.offsetTop;t.toggleClass("fg-wrapped",e),!s&&e&&(s=!0)}),e>=n._wrappedAt&&(n.$container.toggleClass("fg-has-wrapped",s),n._wrappedAt=s?e:0)}},onSearchInput:function(t){var t=t.data.self,e=t.filter.cls.search,s=!h.empty(t.search.$input.val())||t.search.$input.attr("placeholder")!==t.filter.il8n.searchPlaceholder;t.search.$wrap.toggleClass(e.hasValue,s)},onSearchKeydown:function(t){13===t.which&&(t=t.data.self).filter.apply([],t.search.$input.val())},onSearchClear:function(t){t.preventDefault();t=t.data.self;t.search.$wrap.removeClass(t.filter.cls.search.hasValue),t.search.$input.val(""),t.search.$input.attr("placeholder")!==t.filter.il8n.searchPlaceholder&&t.filter.apply([],"")},onSearchSubmit:function(t){t.preventDefault();t=t.data.self;t.filter.apply([],t.search.$input.val())}}),l.filtering.register("tags",l.Tags,l.TagsControl,{type:"tags",position:"top",style:null,align:"center",pushOrReplace:"push",searchPosition:"above-center",collapse:!1},{showCount:"fg-show-count",noTags:"fg-no-tags",wrap:"fg-tag-wrap",list:"fg-tag-list",item:"fg-tag-item",link:"fg-tag-link",text:"fg-tag-text",count:"fg-tag-count",selected:"fg-selected",wrapped:"fg-wrapped",search:{wrap:"fg-search-wrap",inner:"fg-search-inner",input:"fg-search-input",clear:"fg-search-clear",submit:"fg-search-submit",hasValue:"fg-search-has-value",reader:"fg-sr-only"},dropdown:{wrap:"fg-tag-dropdown-wrap",list:"fg-tag-dropdown-list",item:"fg-tag-dropdown",select:"fg-tag-dropdown-select",icon:"fg-tag-dropdown-icon"}},{all:"All",none:"No items found.",searchPlaceholder:"Search gallery...",searchSubmit:"Submit search",searchClear:"Clear search"},-100)}(FooGallery.$,FooGallery,FooGallery.utils,FooGallery.utils.is);