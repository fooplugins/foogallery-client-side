/*
* FooGallery - The Most Intuitive and Extensible Gallery Creation and Management Tool Ever Created for WordPress
* @version 1.4.26
* @link 
* @copyright Steven Usher & Brad Vincent 2015
* @license Released under the GPLv3 license.
*/

!function(a,b,c,d){b.Justified=c.Class.extend({construct:function(c,d){this.tmpl=c,this.$el=c.$el,this.options=a.extend(!0,{},b.Justified.defaults,d),this._items=[],this.maxRowHeight=0,this.borderSize=0},init:function(){this.maxRowHeight=this.getMaxRowHeight(),this.borderSize=this.getBorderSize()},destroy:function(){this.$el.removeAttr("style")},getBorderSize:function(){switch(this.tmpl.getCSSClass("border","")){case"fg-border-thin":return 4;case"fg-border-medium":return 10;case"fg-border-thick":return 16;default:return 0}},getMaxRowHeight:function(){var a=this;return d.string(a.options.maxRowHeight)&&(a.options.maxRowHeight.indexOf("%")?a.options.maxRowHeight=a.options.rowHeight*(parseInt(a.options.maxRowHeight)/100):a.options.maxRowHeight=parseInt(a.options.maxRowHeight)),d.number(a.options.maxRowHeight)?a.options.maxRowHeight:a.options.rowHeight},layout:function(a){var b=this;if(d.number(a)||(a=b.$el.width()),a>0){var c=b.createRows(a);0!==c.height&&c.rows.length>0&&(b.$el.height(c.height),c.rows.forEach(function(a,c){b.render(a)}))}},render:function(a){var b=this;a.items.forEach(function(c){c.elem&&(a.visible?(c.elem.style.setProperty("position","absolute"),c.elem.style.setProperty("width",c.width+"px"),c.elem.style.setProperty("height",c.height+"px"),c.elem.style.setProperty("top",c.top+"px"),c.elem.style.setProperty("left",c.left+"px"),c.elem.style.setProperty("margin","0"),c.elem.style.removeProperty("display"),b.maxRowHeight>0?c.elem.style.setProperty("max-height",b.maxRowHeight+"px"):c.elem.style.removeProperty("max-height"),c.elem.classList.contains("fg-positioned")||c.elem.classList.add("fg-positioned")):c.elem.style.setProperty("display","none"))})},justify:function(a,b,c){var d=this,e=d.options.margins,f=e*(a.items.length-1),g=c-f,h=a.width-f,i=g/h;a.width=h*i,a.height=a.height*i,a.top=b,a.height>d.maxRowHeight&&(a.height=d.maxRowHeight),a.left=0,a.width<g&&(a.left=(g-a.width)/2),a.width+=f;var j=a.left;return a.items.forEach(function(a,c){c>0&&(j+=e),a.left=j,a.top=b,a.width=a.width*i,a.height=a.height*i,a.height>d.maxRowHeight&&(a.height=d.maxRowHeight),j+=a.width}),a.height},position:function(a,b,c,d){var e=this,f=e.options.margins,g=f*(a.items.length-1),h=c-g;if(a.top=b,a.left=0,a.width<h)switch(d){case"center":a.left=(h-a.width)/2;break;case"right":a.left=h-a.width}a.width+=g;var i=a.left;return a.items.forEach(function(a,c){c>0&&(i+=f),a.left=i,a.top=b,i+=a.width}),a.height},lastRow:function(a,b,c){var d=this;return 1===a.items.length&&a.items[0].maxWidth/c>d.options.justifyThreshold||a.width/c>d.options.justifyThreshold?d.justify(a,b,c):d.position(a,b,c,"center")},createRows:function(a){function b(){return{index:++h,visible:!0,width:0,height:d.options.rowHeight+2*d.borderSize,top:0,left:0,items:[]}}function c(a,b){var c=a.width,e=a.height;if(e!==b){var f=b/e;e*=f,c*=f}var g=d.maxRowHeight/b,h=c*g,i=e*g;return{__item:a,elem:a.el,width:c,height:e,maxWidth:h,maxHeight:i,top:0,left:0}}var d=this,e=d.options.margins,f=d.tmpl.getItems(),g=[],h=-1,i=b(),j=0;return f.forEach(function(f){var h=c(f,i.height);i.width+h.width>a&&i.items.length>0&&(g.length>0&&(j+=e),j+=d.justify(i,j,a),g.push(i),i=b()),i.items.length>0&&(i.width+=e),i.width+=h.width,i.items.push(h)}),i.items.length>0&&(g.length>1&&(j+=e),j+=d.lastRow(i,j,a),g.push(i)),{height:j,rows:g}}}),b.Justified.defaults={itemSelector:".fg-item",rowHeight:150,maxRowHeight:"200%",margins:0,lastRow:"center",justifyThreshold:1,refreshInterval:250}}(FooGallery.$,FooGallery,FooGallery.utils,FooGallery.utils.is),function(a,b){b.JustifiedTemplate=b.Template.extend({construct:function(a,b){var c=this;c._super(a,b),c.justified=null,c.on({"pre-init":c.onPreInit,init:c.onInit,destroyed:c.onDestroyed,"first-load layout after-filter-change":c.onLayoutRequired,"page-change":c.onPageChange},c)},onPreInit:function(){var a=this;a.justified=new b.Justified(a,a.template)},onInit:function(){this.justified.init()},onDestroyed:function(){var a=this;a.justified instanceof b.Justified&&a.justified.destroy()},onLayoutRequired:function(){this.justified.layout(this.lastWidth)},onPageChange:function(a,b,c,d){d||this.justified.layout(this.lastWidth)}}),b.template.register("justified",b.JustifiedTemplate,null,{container:"foogallery fg-justified"})}(FooGallery.$,FooGallery);