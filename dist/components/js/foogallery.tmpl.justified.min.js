/*
* FooGallery - The Most Intuitive and Extensible Gallery Creation and Management Tool Ever Created for WordPress
* @version 2.1.2
* @link 
* @copyright Steven Usher & Brad Vincent 2015
* @license Released under the GPLv3 license.
*/
!function(o,s,t,r){s.Justified=t.Class.extend({construct:function(t,e){var i=this;i.tmpl=t,i.$el=t.$el,i.options=o.extend(!0,{},s.Justified.defaults,e),i._items=[],i.maxRowHeight=0,i.borderSize=0,i.align=-1!==["left","center","right"].indexOf(i.options.align)?i.options.align:"center"},init:function(){var t=this;t.maxRowHeight=t.getMaxRowHeight(t.options.maxRowHeight,t.options.rowHeight),t.borderSize=t.getBorderSize()},destroy:function(){this.$el.removeAttr("style")},getBorderSize:function(){switch(this.tmpl.getCSSClass("border","")){case"fg-border-thin":return 4;case"fg-border-medium":return 10;case"fg-border-thick":return 16;default:return 0}},getMaxRowHeight:function(t,e){var i;return r.string(t)?(i=parseInt(t),isNaN(i)?e:i<=0?1/0:-1!==t.indexOf("%")?e*(i/100):i):r.number(t)?t<=0?1/0:t:e},layout:function(t){var i,o=this;0<(t=r.number(t)?t:o.$el.width())&&(0!==(i=o.createRows(t)).height&&0<i.rows.length&&(o.$el.height(i.height),i.rows.forEach(function(t,e){o.render(t,e===i.rows.length-1)})))},render:function(e,t){var i=this,o=!t&&"justify"!==i.options.lastRow;e.items.forEach(function(t){t.elem&&(e.visible?(t.elem.style.setProperty("position","absolute"),t.elem.style.setProperty("width",t.width+"px"),t.elem.style.setProperty("height",t.height+"px"),t.elem.style.setProperty("top",t.top+"px"),t.elem.style.setProperty("left",t.left+"px"),t.elem.style.setProperty("margin","0"),t.elem.style.removeProperty("display"),0<i.maxRowHeight&&o?t.elem.style.setProperty("max-height",i.maxRowHeight+2*i.borderSize+"px"):t.elem.style.removeProperty("max-height"),t.elem.classList.contains("fg-positioned")||t.elem.classList.add("fg-positioned")):t.elem.style.setProperty("display","none"))})},justify:function(i,o,t,e){var s=this,r=s.options.margins,n=r*(i.items.length-1),t=t-n,h=i.width-n,l=t/h,a=(i.width=h*l,i.height=i.height*l,i.height>e+2*s.borderSize&&(h=(e+2*s.borderSize)/i.height,i.width=i.width*h,i.height=i.height*h),i.top=o,i.left=0,"left"!==s.align&&i.width<t&&("right"===s.align?i.left=t-i.width:i.left=(t-i.width)/2),i.width+=n,i.left);return i.items.forEach(function(t,e){0<e&&(a+=r),t.left=a,t.top=o;e=i.height/t.height;t.width=t.width*e,t.height=t.height*e,a+=t.width}),i.height},createRows:function(r){var n=this,h=n.options.margins,t=n.tmpl.getAvailable(),l=[],e=-1;function a(){return{index:++e,visible:!0,width:0,height:n.options.rowHeight+2*n.borderSize,top:0,left:0,items:[]}}var d=a(),g=0,u=0;if(t.forEach(function(t){s=d.height,e=t.width,(i=t.height)!==s&&(i*=o=s/i,e*=o),o=n.maxRowHeight/s;var e,i,o,s={__item:t,elem:t.el,width:e,height:i,maxWidth:e*o,maxHeight:i*o,top:0,left:0};d.width+s.width>r&&0<d.items.length&&(0<l.length&&(g+=h),t=n.justify(d,g,r,n.maxRowHeight),u<t&&(u=t),g+=t,l.push(d),d=a()),0<d.items.length&&(d.width+=h),d.width+=s.width,d.items.push(s)}),0<d.items.length){var i=g+h;switch(n.options.lastRow){case"smart":var o,s,f=n.justify(d,i,r,n.maxRowHeight);0!==u&&u<f&&(o=u/f,s=d.width*o/r,(o<.9||s<.9)&&(f=n.justify(d,i,r,u-2*n.borderSize)));break;case"justify":f=n.justify(d,i,r,99999);break;case"hide":f=n.justify(d,i,r,n.maxRowHeight),d.width<r&&1<l.length&&(d.visible=!1)}d.visible&&(g+=f+h),l.push(d)}return{height:g,rows:l}}}),s.Justified.defaults={rowHeight:150,maxRowHeight:"200%",margins:0,align:"center",lastRow:"smart"}}(FooGallery.$,FooGallery,FooGallery.utils,FooGallery.utils.is),function(t){t.JustifiedTemplate=t.Template.extend({construct:function(t,e){var i=this;i._super(t,e),i.justified=null,i.on({"pre-init":i.onPreInit,init:i.onInit,destroyed:i.onDestroyed,"layout after-filter-change":i.onLayoutRequired,"page-change":i.onPageChange},i)},onPreInit:function(){this.justified=new t.Justified(this,this.template)},onInit:function(){this.justified.init()},onDestroyed:function(){this.justified instanceof t.Justified&&this.justified.destroy()},onLayoutRequired:function(){this.justified.layout(this.lastWidth)},onPageChange:function(t,e,i,o){o||this.justified.layout(this.lastWidth)}}),t.template.register("justified",t.JustifiedTemplate,null,{container:"foogallery fg-justified"})}((FooGallery.$,FooGallery));